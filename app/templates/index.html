{% extends 'base.html' %} {% block content %}
<div class="row">
  <div class="col-lg-12">
    {% with messages = get_flashed_messages(with_categories=true) %} {% for
    category, message in messages %}
    <div class="alert alert-{{ category }} mt-3">{{ message }}</div>
    {% endfor %} {% endwith %}
    
    <table class="table table-striped">
      <thead>
        <tr>
          <th>#</th>
          <th>ФИО</th>
          <th>Роль</th>
          <th>Действия</th>
        </tr>
      </thead>
      <tbody>
        {% for user in users %}
        <tr>
          <td>{{ loop.index }}</td>
          <td>{{ user.surname or '' }} {{ user.name or '' }} {{ user.patronymic or '' }}</td>
          <td>{{ user.role.name if user.role else '' }}</td>
          <td>
            <a class="btn btn-info btn-sm" href="{{ url_for('view_user', user_id=user.id) }}">Просмотр</a>
            {% if current_user.is_authenticated %}
            <a class="btn btn-primary btn-sm" href="{{ url_for('edit_user', user_id=user.id) }}">Редактировать</a>
            <!-- Кнопка для открытия модального окна -->
      <button type="button" class="btn btn-danger btn-sm" data-bs-toggle="modal" data-bs-target="#deleteModal{{ user.id }}">
        Удалить
      </button>

      <!-- Модальное окно подтверждения удаления -->
      <div class="modal fade" id="deleteModal{{ user.id }}" tabindex="-1" aria-labelledby="deleteModalLabel{{ user.id }}" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="deleteModalLabel{{ user.id }}">Подтверждение удаления</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Закрыть"></button>
            </div>
            <div class="modal-body">
              Вы уверены, что хотите удалить пользователя {{ user.surname }} {{ user.name }} {{ user.patronymic }}?
            </div>
            <div class="modal-footer">
              <form method="post" action="{{ url_for('delete_user', user_id=user.id) }}">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Нет</button>
                <button type="submit" class="btn btn-danger">Да</button>
              </form>
            </div>
            {% endif %}
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>

    
    {% if current_user.is_authenticated %}
    <a href="{{ url_for('create_user') }}" class="btn btn-success">Создание пользователя</a>
    {% endif %}

{% endblock %}
